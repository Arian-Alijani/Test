name: Self-Hosted Runner Smoke Test

on:
  workflow_dispatch:

jobs:
  smoke:
    runs-on: [self-hosted, linux, x64]
    timeout-minutes: 10
    steps:
      - name: Print runner context
        shell: bash
        run: |
          set -Eeuo pipefail
          echo "Runner picked successfully."
          echo "RUNNER_NAME=${RUNNER_NAME}"
          echo "RUNNER_OS=${RUNNER_OS}"
          echo "RUNNER_ARCH=${RUNNER_ARCH}"
          echo "GITHUB_REPOSITORY=${GITHUB_REPOSITORY}"
          echo "GITHUB_RUN_ID=${GITHUB_RUN_ID}"
          echo "UTC_TIME=$(date -u +"%Y-%m-%dT%H:%M:%SZ")"

      - name: Validate expected platform
        shell: bash
        run: |
          set -Eeuo pipefail
          [[ "${RUNNER_OS}" == "Linux" ]] || { echo "Expected Linux runner, got ${RUNNER_OS}"; exit 1; }
          [[ "${RUNNER_ARCH}" == "X64" ]] || { echo "Expected X64 runner, got ${RUNNER_ARCH}"; exit 1; }
          echo "Platform validation passed."

      - name: Done
        shell: bash
        run: |
          set -Eeuo pipefail
          echo "کار انجام شد: self-hosted runner پیدا شد و job با موفقیت اجرا شد."
